(self["webpackChunkhydro_flex_control"]=self["webpackChunkhydro_flex_control"]||[]).push([[3511],{50080:function(t,e,n){var r=n(20596);r.__esModule&&(r=r.default),"string"===typeof r&&(r=[[t.id,r,""]]),r.locals&&(t.exports=r.locals);var a=n(69333).A;a("55e95cd6",r,!0,{sourceMap:!1,shadowMode:!1})},18642:function(t,e,n){var r=n(86070);r.__esModule&&(r=r.default),"string"===typeof r&&(r=[[t.id,r,""]]),r.locals&&(t.exports=r.locals);var a=n(69333).A;a("14d04b7c",r,!0,{sourceMap:!1,shadowMode:!1})},81372:function(t,e,n){var r=n(75872);r.__esModule&&(r=r.default),"string"===typeof r&&(r=[[t.id,r,""]]),r.locals&&(t.exports=r.locals);var a=n(69333).A;a("2c8b12c9",r,!0,{sourceMap:!1,shadowMode:!1})},86292:function(t,e,n){var r=n(59808);r.__esModule&&(r=r.default),"string"===typeof r&&(r=[[t.id,r,""]]),r.locals&&(t.exports=r.locals);var a=n(69333).A;a("3e87a8ee",r,!0,{sourceMap:!1,shadowMode:!1})},88757:function(t,e,n){"use strict";var r;n.d(e,{A:function(){return l}});var a,i=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("v-uni-view",{staticClass:"u-loading-page"})},u=[],s={props:{},data(){return{}},methods:{}},o=s,c=n(18535),d=(0,c.A)(o,i,u,!1,null,"7d253128",null,!1,r,a),l=d.exports},80903:function(t,e,n){"use strict";n.d(e,{A:function(){return l}});var r,a={uTabs:n(36101).A},i=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("u-tabs",{staticClass:"tabs",attrs:{name:t.name,list:t.list,"is-scroll":!0,current:t.current,"show-bar":t.showBar,"font-size":28,"active-color":t.activeColor,"inactive-color":t.inactiveColor,"bar-width":t.barWidth,bold:t.bold},on:{change:function(e){arguments[0]=e=t.$handleEvent(e),t.change.apply(void 0,arguments)}}})},u=[],s=(n(2892),{name:"Tabs",props:{list:Array,current:{type:Number,default:0},name:String,showBar:{type:Boolean,default:!0},activeColor:{type:String,default:"#00A096"},inactiveColor:{type:String,default:"#999"},barWidth:{type:Number,default:60},bold:{type:Boolean,default:!1}},methods:{change:function(t){this.$emit("update:current",t)}}}),o=s,c=(n(18642),n(18535)),d=(0,c.A)(o,i,u,!1,null,"6734ca90",null,!1,a,r),l=d.exports},85707:function(t,e,n){"use strict";var r;n.r(e),n.d(e,{default:function(){return Q}});var a,i,u=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("v-uni-view",{staticClass:"container"},[n("v-uni-view",{staticClass:"TabsView"},[n("DutyDetail")],1)],1)},s=[],o={uLoadingPage:n(88757).A},c=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("v-uni-view",{staticClass:"dutyContainer"},[n("v-uni-view",{staticClass:"top"},[n("WuCalendar",{attrs:{itemHeight:30,color:"#03654e"},on:{change:function(e){arguments[0]=e=t.$handleEvent(e),t.dateChange.apply(void 0,arguments)}}}),n("Picker",{staticClass:"picker",attrs:{pickerList:t.pickerList,pickerCurrentIndex:t.pickerCurrentIndex,hasBkg:!1,hasPadding:!1},on:{"update:pickerCurrentIndex":function(e){arguments[0]=e=t.$handleEvent(e),t.pickerCurrentIndex=e},"update:picker-current-index":function(e){arguments[0]=e=t.$handleEvent(e),t.pickerCurrentIndex=e}}})],1),n("v-uni-view",{staticClass:"bottom"},[n("Tabs",{attrs:{name:"cate_name",list:t.list,current:t.current},on:{"update:current":function(e){arguments[0]=e=t.$handleEvent(e),t.current=e}}}),n("SelectPeople",{staticClass:"selectPeople",attrs:{cardList:t.cardList,disabledClick:t.disabledClick},on:{cardClick:function(e){arguments[0]=e=t.$handleEvent(e),t.cardClick.apply(void 0,arguments)}}}),n("v-uni-view",{staticClass:"btnWrap"},[n("MButton",{attrs:{btnName:"提交"},on:{confirm:function(e){arguments[0]=e=t.$handleEvent(e),t.confirm.apply(void 0,arguments)}}}),n("MButton",{attrs:{btnName:"调度班"},on:{confirm:function(e){arguments[0]=e=t.$handleEvent(e),t.goto.apply(void 0,arguments)}}})],1)],1),n("u-loading-page",{attrs:{loading:t.loading}})],1)},d=[],l=n(42727),f=n(50575),h=(n(2008),n(62062),n(26099),n(69673)),p=n(20599),v=n(80903),m=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("v-uni-view",{staticClass:"spContainer"},[n("ListViewVertical",t._g(t._b({attrs:{cardList:t.cardList,isFlex:!0,hasLoadMore:!1},scopedSlots:t._u([{key:"default",fn:function(e){var r=e.content;return[n("v-uni-view",{staticClass:"spWrap"},[n("v-uni-view",{staticClass:"txt",staticStyle:{background:"#b6e8de"}},[t._v(t._s(r.name||r.nickName))])],1)]}}])},"ListViewVertical",t.$attrs,!1),t.$listeners))],1)},y=[],g=n(57746),w={name:"SelectPeople",props:{cardList:Array},data:function(){return{}},components:{ListViewVertical:g.A},methods:{}},b=w,k=(n(50080),n(18535)),x=(0,k.A)(b,m,y,!1,null,"32a5626e",null,!1,a,i),A=x.exports,C=n(26415),_=n(50771);n(64761),n(61182);var D,I,S=n(49943),L=n(63065),P=n(51729),E=(n(28706),n(50113),n(79432),n(23500),n(59446)),M=n(46920),T=n(16657),$=n(43859)["A"],N=function(){function t(){(0,L.A)(this,t),this.userList=[],this.schedule=null,this.morning={master:[],staff:[]},this.afternoon={master:[],staff:[]},this.evening={master:[],staff:[]},this.shiftMapping={morning:"morning",afternoon:"after",evening:"evening"}}return(0,P.A)(t,[{key:"initializeData",value:function(){var t=(0,f.A)((0,l.A)().mark((function t(e){return(0,l.A)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,this.getUserList();case 3:return t.next=5,this.getTodayDuty(e);case 5:this.processSchedule(),t.next=11;break;case 8:t.prev=8,t.t0=t["catch"](0),$.error("Error initializing data:",t.t0);case 11:case"end":return t.stop()}}),t,this,[[0,8]])})));function e(e){return t.apply(this,arguments)}return e}()},{key:"processSchedule",value:function(){var t=this,e=["morning","afternoon","evening"],n=["master","staff"];$.log(this.userList,this.schedule),e.forEach((function(e){var r=t.shiftMapping[e];n.forEach((function(n){t[e][n]=t.userList.map((function(e){var a=t.schedule&&t.schedule[r]&&t.schedule[r][n]&&t.schedule[r][n].some((function(t){return t.userId===e.userId}));return(0,S.A)((0,S.A)({},e),{},{checked:a})}))}))}))}},{key:"getUserList",value:function(){var t=(0,f.A)((0,l.A)().mark((function t(){var e,n;return(0,l.A)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e=M.A.getters.plantId,t.next=3,(0,E.aU)({powerPlantId:e,pageNum:1,pageSize:999});case 3:n=t.sent,this.userList=n.rows;case 5:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}()},{key:"getTodayDuty",value:function(){var t=(0,f.A)((0,l.A)().mark((function t(e){var n;return(0,l.A)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,(0,T.Su)(e);case 2:n=t.sent,this.schedule=n.rows[0]||null;case 4:case"end":return t.stop()}}),t,this)})));function e(e){return t.apply(this,arguments)}return e}()},{key:"addTodayDuty",value:function(){var t=(0,f.A)((0,l.A)().mark((function t(e){var n,r;return(0,l.A)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return n=this.formatDutyData(e),t.next=3,(0,T.ty)(n);case 3:return r=t.sent,r.success&&(this.schedule=r.data,this.processSchedule()),t.abrupt("return",r);case 6:case"end":return t.stop()}}),t,this)})));function e(e){return t.apply(this,arguments)}return e}()},{key:"editTodayDuty",value:function(){var t=(0,f.A)((0,l.A)().mark((function t(e){var n,r;return(0,l.A)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return n=this.formatDutyData(e),t.next=3,(0,T.k8)(n);case 3:return r=t.sent,r.success&&(this.schedule=r.data,this.processSchedule()),t.abrupt("return",r);case 6:case"end":return t.stop()}}),t,this)})));function e(e){return t.apply(this,arguments)}return e}()},{key:"formatDutyData",value:function(t){var e=this;if(!t)return $.error("dutyData is undefined or null"),null;var n={id:this.schedule?this.schedule.id:"",plantId:t.plantId,date:t.date,morning:{master:[],staff:[]},after:{master:[],staff:[]},evening:{master:[],staff:[]}};return Object.keys(this.shiftMapping).forEach((function(r){var a=e.shiftMapping[r];t[r]?["master","staff"].forEach((function(i){Array.isArray(t[r][i])?n[a][i]=t[r][i].map((function(t){return{userId:t.userId,userName:t.nickName||t.userName,scheduleId:e.schedule?e.schedule.id:"",shift:a,role:i}})):($.warn("dutyData[".concat(r,"][").concat(i,"] is not an array")),n[a][i]=[])})):($.warn("dutyData[".concat(r,"] is undefined")),n[a]={master:[],staff:[]})})),n}},{key:"getDutyPersonnel",value:function(t,e){return this[t][e].filter((function(t){return t.checked}))}},{key:"toggleUserDuty",value:function(t,e,n,r){var a=this[t][e].find((function(t){return t.userId===n}));a&&(a.checked=r)}}])}(),R=N,B=n(43859)["A"],F={name:"DutyDetail",components:{WuCalendar:h.A,Picker:p.A,Tabs:v.A,SelectPeople:A,MButton:C.A},data:function(){return{pickerList:["早班","中班","晚班"],pickerCurrentIndex:0,list:[{id:0,cate_name:"带班领导"},{id:1,cate_name:"值班人员"}],current:0,currentDate:"",cardList:[],queryParams:{date:"",plantId:""},morning:{master:[],staff:[]},afternoon:{master:[],staff:[]},evening:{master:[],staff:[]},submitForm:{id:"",plantId:"",date:"",morning:{},after:{},evening:{}},dutySchedule:null,loading:!1}},computed:{disabledClick:function(){var t=new Date;t.setHours(0,0,0,0);var e=new Date(this.currentDate);return e.setHours(0,0,0,0),e<=t},currentShift:function(){return["morning","afternoon","evening"][this.pickerCurrentIndex]},currentRole:function(){return 0===this.current?"master":"staff"}},mounted:function(){var t=this;return(0,f.A)((0,l.A)().mark((function e(){return(0,l.A)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t.loading=!0,e.prev=1,t.dutySchedule=new R,t.setIntQuery(),e.next=6,t.dutySchedule.initializeData(t.queryParams);case 6:t.updateCardList(),e.next=13;break;case 9:e.prev=9,e.t0=e["catch"](1),B.error("Error initializing duty schedule:",e.t0),(0,_.oR)("初始化数据失败，请重试");case 13:return e.prev=13,t.loading=!1,e.finish(13);case 16:case"end":return e.stop()}}),e,null,[[1,9,13,16]])})))()},created:function(){this.setIntQuery(),this.setIntSubmit(),this.currentDate=this.getNowDate()},methods:{goto:function(){this.$tab.navigateTo("/pages/schedule/index")},setIntQuery:function(){this.queryParams.plantId=M.A.getters.plantId,this.queryParams.date=this.getNowDate()},setIntSubmit:function(){this.submitForm.plantId=M.A.getters.plantId,this.submitForm.date=this.getNowDate()},getNowDate:function(){return(0,_.Ey)(Date.now())},dateChange:function(t){var e=this;return(0,f.A)((0,l.A)().mark((function n(){return(0,l.A)().wrap((function(n){while(1)switch(n.prev=n.next){case 0:return e.currentDate=t.fulldate,e.queryParams.date=e.currentDate,e.submitForm.date=e.currentDate,n.next=5,e.refresh();case 5:case"end":return n.stop()}}),n)})))()},cardClick:function(t){var e=this;return(0,f.A)((0,l.A)().mark((function n(){var r,a;return(0,l.A)().wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(r=t.item,a=t.active,B.log(e.disabledClick,"this.disabledClick"),!e.disabledClick){n.next=5;break}return(0,_.oR)("无法更改当日及当日之前的数据~"),n.abrupt("return");case 5:e.dutySchedule.toggleUserDuty(e.currentShift,e.currentRole,r.userId,a),e.updateCardList();case 7:case"end":return n.stop()}}),n)})))()},updateCardList:function(){this.cardList=this.dutySchedule[this.currentShift][this.currentRole]},refresh:function(){var t=this;return(0,f.A)((0,l.A)().mark((function e(){return(0,l.A)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t.loading=!0,e.prev=1,e.next=4,t.dutySchedule.getTodayDuty(t.queryParams);case 4:t.dutySchedule.processSchedule(),t.updateCardList(),e.next=12;break;case 8:e.prev=8,e.t0=e["catch"](1),B.error("Error refreshing duty schedule:",e.t0),(0,_.oR)("刷新数据失败，请重试");case 12:return e.prev=12,t.loading=!1,e.finish(12);case 15:case"end":return e.stop()}}),e,null,[[1,8,12,15]])})))()},confirm:function(){var t=this;return(0,f.A)((0,l.A)().mark((function e(){var n,r;return(0,l.A)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!t.disabledClick){e.next=3;break}return(0,_.oR)("无法更改当日及当日之前的数据~"),e.abrupt("return");case 3:if(t.loading=!0,e.prev=4,n={plantId:t.submitForm.plantId,date:t.submitForm.date,morning:{master:t.getDutyPersonnel("morning","master"),staff:t.getDutyPersonnel("morning","staff")},afternoon:{master:t.getDutyPersonnel("afternoon","master"),staff:t.getDutyPersonnel("afternoon","staff")},evening:{master:t.getDutyPersonnel("evening","master"),staff:t.getDutyPersonnel("evening","staff")}},!t.dutySchedule.schedule){e.next=12;break}return e.next=9,t.dutySchedule.editTodayDuty(n);case 9:e.t0=e.sent,e.next=15;break;case 12:return e.next=14,t.dutySchedule.addTodayDuty(n);case 14:e.t0=e.sent;case 15:if(r=e.t0,200!==r.code){e.next=22;break}return(0,_.oR)("更改成功！"),e.next=20,t.refresh();case 20:e.next=23;break;case 22:(0,_.oR)("更改失败，请重试");case 23:e.next=29;break;case 25:e.prev=25,e.t1=e["catch"](4),B.error("Error confirming duty schedule:",e.t1),(0,_.oR)("提交失败，请重试");case 29:return e.prev=29,t.loading=!1,e.finish(29);case 32:case"end":return e.stop()}}),e,null,[[4,25,29,32]])})))()},getDutyPersonnel:function(t,e){return this.dutySchedule[t][e].filter((function(t){return t.checked})).map((function(t){return{userId:t.userId,nickName:t.nickName}}))}},watch:{pickerCurrentIndex:function(){this.updateCardList()},current:function(){this.updateCardList()}}},U=F,W=(n(81372),(0,k.A)(U,c,d,!1,null,"040dc680",null,!1,o,D)),z=W.exports,V={components:{DutyDetail:z},data:function(){return{current:0}},computed:{},methods:{},watch:{},onLoad:function(){},onReady:function(){},onShow:function(){},onHide:function(){},onUnload:function(){}},q=V,H=(n(86292),(0,k.A)(q,u,s,!1,null,"6a94fb94",null,!1,r,I)),Q=H.exports},20596:function(t,e,n){"use strict";n.r(e);var r=n(45522),a=n.n(r),i=n(67643),u=n.n(i),s=u()(a());s.push([t.id,'@charset "UTF-8";\r\n/**\r\n * uni-app内置的常用样式变量\r\n */\r\n/* 主题颜色 */\r\n/* 文字大小 */\r\n/* 字重 */\r\n/* 文字颜色 */\r\n/* 行为相关颜色 */\r\n/* 文字基本颜色 */\r\n/* 背景颜色 */\r\n/* 边框颜色 */\r\n/* 尺寸变量 */\r\n/* 文字尺寸 */\r\n/* 图片尺寸 */\r\n/* Border Radius */\r\n/* 水平间距 */\r\n/* 垂直间距 */\r\n/* 透明度 */\r\n/* 文章场景相关 */.spWrap .txt[data-v-32a5626e]{text-overflow:ellipsis;overflow:hidden;white-space:nowrap;color:#03654e}[data-v-32a5626e] .flexWrap{background:#fff}',""]),e["default"]=s},86070:function(t,e,n){"use strict";n.r(e);var r=n(45522),a=n.n(r),i=n(67643),u=n.n(i),s=u()(a());s.push([t.id,'@charset "UTF-8";\r\n/**\r\n * uni-app内置的常用样式变量\r\n */\r\n/* 主题颜色 */\r\n/* 文字大小 */\r\n/* 字重 */\r\n/* 文字颜色 */\r\n/* 行为相关颜色 */\r\n/* 文字基本颜色 */\r\n/* 背景颜色 */\r\n/* 边框颜色 */\r\n/* 尺寸变量 */\r\n/* 文字尺寸 */\r\n/* 图片尺寸 */\r\n/* Border Radius */\r\n/* 水平间距 */\r\n/* 垂直间距 */\r\n/* 透明度 */\r\n/* 文章场景相关 */.tabs[data-v-6734ca90]{width:%?750?%;border-top:%?1?% solid #f3f3f3}',""]),e["default"]=s},75872:function(t,e,n){"use strict";n.r(e);var r=n(45522),a=n.n(r),i=n(67643),u=n.n(i),s=u()(a());s.push([t.id,'@charset "UTF-8";\r\n/**\r\n * uni-app内置的常用样式变量\r\n */\r\n/* 主题颜色 */\r\n/* 文字大小 */\r\n/* 字重 */\r\n/* 文字颜色 */\r\n/* 行为相关颜色 */\r\n/* 文字基本颜色 */\r\n/* 背景颜色 */\r\n/* 边框颜色 */\r\n/* 尺寸变量 */\r\n/* 文字尺寸 */\r\n/* 图片尺寸 */\r\n/* Border Radius */\r\n/* 水平间距 */\r\n/* 垂直间距 */\r\n/* 透明度 */\r\n/* 文章场景相关 */.dutyContainer[data-v-040dc680]{height:100%;display:flex;flex-direction:column}.dutyContainer .top[data-v-040dc680]{position:relative}.dutyContainer .top .picker[data-v-040dc680]{position:absolute;top:%?22?%;right:%?80?%;width:%?120?%}.dutyContainer .top[data-v-040dc680]  .wu-calendar-item__weeks-lunar-text{display:none}.dutyContainer .top[data-v-040dc680]  .wu-calendar__header{justify-content:flex-start;font-weight:700}.dutyContainer .top[data-v-040dc680]  .wu-calendar__header .wu-calendar__header-btn-box.horizontal{width:%?80?%}.dutyContainer .top[data-v-040dc680]  .wu-calendar__header .wu-calendar__header-btn-box.horizontal .wu-calendar__header-btn{border-left-width:%?6?%;border-top-width:%?6?%}.dutyContainer .top[data-v-040dc680]  .wu-calendar-item__weeks-box-item{\r\n  /* width: 54rpx!important;\r\n\t\theight: 54rpx!important;\r\n\t\tborder-radius: 27rpx!important; */}.dutyContainer .bottom[data-v-040dc680]{flex:1;display:flex;flex-direction:column;overflow:hidden;width:100%}.dutyContainer .bottom[data-v-040dc680]  .u-tabs.tabs{border-bottom:%?1?% solid #d9d9d9}.dutyContainer .bottom[data-v-040dc680]  .u-tabs.tabs .u-tab-item{width:50%!important}.dutyContainer .bottom .selectPeople[data-v-040dc680]{flex:1;overflow:hidden}.dutyContainer .bottom .btnWrap[data-v-040dc680]{padding:%?30?% 0;background-color:#fff;\r\n  /* margin-top: auto; */display:flex}[data-v-040dc680] .wu-calendar__header-text,[data-v-040dc680] #u-tab-item-1,[data-v-040dc680] .wu-calendar-item__weeks-box-text,[data-v-040dc680] .wu-calendar__weeks-day-text,[data-v-040dc680] .wrap,[data-v-040dc680] .wu-calendar__backtoday{color:#03654e}[data-v-040dc680] .u-tab-item{color:#03654e!important}[data-v-040dc680] .uni-card.card.uni-card--full.uni-card--border{background:#b6e8de!important}',""]),e["default"]=s},59808:function(t,e,n){"use strict";n.r(e);var r=n(45522),a=n.n(r),i=n(67643),u=n.n(i),s=u()(a());s.push([t.id,'@charset "UTF-8";\r\n/**\r\n * uni-app内置的常用样式变量\r\n */\r\n/* 主题颜色 */\r\n/* 文字大小 */\r\n/* 字重 */\r\n/* 文字颜色 */\r\n/* 行为相关颜色 */\r\n/* 文字基本颜色 */\r\n/* 背景颜色 */\r\n/* 边框颜色 */\r\n/* 尺寸变量 */\r\n/* 文字尺寸 */\r\n/* 图片尺寸 */\r\n/* Border Radius */\r\n/* 水平间距 */\r\n/* 垂直间距 */\r\n/* 透明度 */\r\n/* 文章场景相关 */uni-page-body[data-v-6a94fb94],\r\n#app[data-v-6a94fb94]{font-size:%?28?%;height:100%;overflow:hidden;color:#000}.container[data-v-6a94fb94]{height:100%;display:flex;flex-direction:column}.container .TabsView[data-v-6a94fb94]{height:100%;display:flex;flex-direction:column;overflow:hidden}[data-v-6a94fb94] .flexWrap .disabled::after{background-color:initial!important}',""]),e["default"]=s},16657:function(t,e,n){"use strict";n.d(e,{Su:function(){return a},k8:function(){return u},ty:function(){return i}});var r=n(41325),a=function(t){return(0,r.A)({url:"/nus/schedule/list",method:"get",params:t})},i=function(t){return(0,r.A)({url:"/nus/schedule",method:"post",data:t})},u=function(t){return(0,r.A)({url:"/nus/schedule",method:"put",data:t})}},59446:function(t,e,n){"use strict";n.d(e,{aU:function(){return a},cm:function(){return u},gq:function(){return s},ug:function(){return i}});n(28706);var r=n(41325),a=function(t){return(0,r.A)({url:"/system/user/list",method:"get",params:t})},i=function(t){return(0,r.A)({url:"/system/user/".concat(t.userId),method:"get"})},u=function(t){return(0,r.A)({url:"/system/user/bindPost?userId=".concat(t.userId,"&postIds=").concat(t.postIds),method:"put"})},s=function(t){return(0,r.A)({url:"/system/dept/list",method:"get",params:t})}}}]);